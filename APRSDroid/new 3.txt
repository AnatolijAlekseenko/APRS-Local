//получаем кмат и обрезаем до 3-х символов, далее в справочние ЦБ подставляем значение kod_c при этом убираю первое значение символ Е
    public static string GetCommFromENS(string kmat)
    {

       string ret = string.Empty;
       string kmatFromDefault = kmat;

        var oldKmat = SqlClient.Main.CreateCommand(string.Format(@"select oldkmat from ksm where kmat = @kmat"), new { kmat = kmat }).ExecScalar<string>();

        if(oldKmat!=string.Empty)
        { 
        InfoManager.MessageBox("KMAT:{0} OLDKMAT:{1}",kmat,oldKmat);


        kmat = oldKmat.Substring(0, 3);
        
        //проходим по всему справочнику
        var objects = SqlClient.Main.CreateCommand(string.Format(@"select kod_c,naim from DSTEEL1.ADT_MAIN.Nikopol_sql.sp2 where sp2.spr='_NP' -- and kod_c = @kmat
                                                "), new {kmat = kmat }).ExecObjects(new { kod_c = string.Empty, naim = string.Empty });

        foreach (var obj in objects)
        {
            if (obj.kod_c.Substring(0, 1) == "Е" || obj.kod_c.Substring(0, 1) == "E")
            {
                //Удаляем первый символ Е
                var newKod_c = obj.kod_c.Remove(0, 1);
                if (kmat == newKod_c)
                {
                    var getNaim = SqlClient.Main.CreateCommand(string.Format(@"select naim from DSTEEL1.ADT_MAIN.Nikopol_sql.sp2 where sp2.spr='_NP' and right(rtrim(kod_c),3) = @newKod_c"), new { newKod_c = newKod_c }).ExecScalar<string>();
                    return getNaim;
                }
             }
            else
            {
                //select top 1 nmat from ksm where kmat = '201100000000000'
                //Другие символы помимо Е не обрабатываем вообще
            }
        }
        }
        var getDefaultNaim = SqlClient.Main.CreateCommand(string.Format(@"select top 1 nmat from ksm where kmat = @kmat"), new { kmat = kmatFromDefault }).ExecScalar<string>();
        return getDefaultNaim;
    }